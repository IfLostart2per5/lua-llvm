language: c
sudo: required
dist: trusty

compiler:
  - clang

os:
  - linux
  - osx

env:
  global:
    - LUA_VERSION=LUA53
  matrix:
    - LLVM_VERSION="4.0"

before_install:
  - export PATH="$TRAVIS_BUILD_DIR/install/bin:$TRAVIS_BUILD_DIR/install/latest-llvm-symlinks:$PATH"
  - PREFIX="$TRAVIS_BUILD_DIR/install" PLAT="${TRAVIS_OS_NAME/osx/macosx}" TMPSRC="$TRAVIS_BUILD_DIR/.src" .travis/install_lua.sh
  - PREFIX="$TRAVIS_BUILD_DIR/install" .travis/install_llvm.sh
  - ls -lah $TRAVIS_BUILD_DIR/install
  - ls -lah $TRAVIS_BUILD_DIR/install/latest-llvm-symlinks


install:
  - luarocks install --local busted

script:
  - luarocks make --server=http://luarocks.org/dev

test:
  - busted spec
